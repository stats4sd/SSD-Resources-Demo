


<!--import polymer html and shared styles-->
<link rel="import" href="../bower_components/polymer/polymer.html">
<!-- <link rel="import" href="../bower_components/note-app-elements/na-elements.html"> -->
<link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<!-- <link rel="import" href="../bower_components/juicy-jsoneditor/juicy-jsoneditor.html"> -->
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/polymer-bootstrap/polymer-bootstrap.html">

<!--give id reference of page name-->
<dom-module id="ssd-admin-tags">
  <!-- topicS -->
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
    </style>
    <style include="polymer-bootstrap"></style>
    <!--Add template content here-->
    <!-- Get the list of all topic tags and bind it to {{allTags}} -->
    <firebase-document app="SSD-Resources" app-name="SSD-Resources" path="/topics" data="{{allTopics}}">
    </firebase-document>
    <h1>Administration - Metadata</h1>
    <p>Use this page to modify the lists of tags, collections etc that can be attached to resources.</p>
    <p>We've started with a few types of tag, to help organise and guide our development. If you want to create tags that don't fit into these boxes, use the "uncategorised tags" at the bottom of the page.  New tag types may naturally form out of them as we develop the database.</p>
      <!-- #################topics################ -->
    <div class='row' id='main_topics'>
        <div class="col-md-6">
          <div class='card'>
            <h2>Topics</h2>
            <p>The first collection of tags is "topics".  What is the resource about? In this early stage, this is just an unstructured list. Later, we may consider sub-lists (e.g. General Linear Models and Multiple Regression are also both "Modelling").</p>
            <h4>Instructions</h4>
            <ul><li>Add new topics using the text box below.</li>
              <li>To edit an existing tag, click on it in the list, then make the edit in the text box. Click save to overwrite that tag.</li>
              <li>To remove a tag, click on it in the list, then click the 'remove' button.</li>
            </ul>
            <paper-input id="topic-input" name="topic-input" label="Add/Edit topic" value="{{topicInput}}" on-keypress="_topicPressed"  max="100" char-counter>
            </paper-input>
            <paper-button raised on-tap="addtopic">Save</paper-button>
            <paper-button raised on-tap="removetopic">Remove</paper-button>
          </div>
        </div>
        <div class='col-md-6'>
          <div class='card'>
            <h3>Topics List</h3>

            <div class='list-group'>
              <!-- use a dom-repeat to list every element in the {{allTopics}} object -->
              <template is="dom-repeat" items="{{allTopics}}" as="topic">
                <button type="button" class="list-group-item" on-tap="edittopic" id="li-{{index}}">[[topic]]</button>
              </template>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- Resource Types -->

    <!--Add template content here-->
    <!-- Get the list of all rType tags and bind it to {{allTags}} -->
    <firebase-document app="SSD-Resources" app-name="SSD-Resources" path="/rTypes" data="{{allrTypes}}">
    </firebase-document>

    <!-- #################rTypes################ -->
    <div class='row' id='main_rTypes'>
      <div class="col-md-6">
        <div class="card">
          <h2>Resource Types</h2>
          <p>What type of resource is it? This is more than just the file-type - think about how resources will be used (For training, or as a software / setup guide, or a reference manual etc)</p>
          <paper-input id="rType-input" name="rType-input" label="Add/Edit rType" value="{{rTypeInput}}" on-keypress="_rTypePressed" max="100" char-counter>
          </paper-input>
          <paper-button raised on-tap="addrType">Save</paper-button>
          <paper-button raised on-tap="removerType">Remove</paper-button>
        </div>
      </div>
      <div class='col-md-6'>
        <div class='card'>
          <h3>Resource Types List</h3>
          <div class='list-group'>
            <!-- use a dom-repeat to list every element in the {{allrTypes}} object -->
            <template is="dom-repeat" items="{{allrTypes}}" as="rType">
              <button type="button" class="list-group-item" on-tap="editrType" id="li-{{index}}">[[rType]]</button>
            </template>
          </div>
      </div>
    </div>
  </div>

  <!-- Collections -->

    <!--Add template content here-->
    <!-- Get the list of all collection tags and bind it to {{allTags}} -->
    <firebase-document app="SSD-Resources" app-name="SSD-Resources" path="/collections" data="{{allcollections}}">
    </firebase-document>

    <!-- #################collections################ -->
    <div class='row' id='main_collections'>
      <div class="col-md-6">
        <div class="card">
          <h2>collections</h2>
          <p>Collections can be materials from a particular course (e.g. eSIAC), a set of resources written for a specific contract, or a compiled set of resources used at a workshop.  For example, all the resources used and referenced at the Kenya workshop (Feb 2017) might be put into a new collection.</p>
          <paper-input id="collection-input" name="collection-input" label="Add/Edit collection" value="{{collectionInput}}" on-keypress="_collectionPressed"max="100" char-counter>
          </paper-input>
          <paper-button raised on-tap="addcollection">Save</paper-button>
          <paper-button raised on-tap="removecollection">Remove</paper-button>
        </div>
      </div>
      <div class='col-md-6'>
        <div class='card'>
          <h3>collections List</h3>

          <div class='list-group'>
            <!-- use a dom-repeat to list every element in the {{allcollections}} object -->
            <template is="dom-repeat" items="{{allcollections}}" as="collection">
              <button type="button" class="list-group-item" on-tap="editcollection" id="li-{{index}}">[[collection]]</button>
            </template>
          </div>
      </div>
    </div>
  </div>

  <firebase-document app="SSD-Resources" app-name="SSD-Resources" path="/tags" data="{{alltags}}">
  </firebase-document>
  <div class='row' id='main_tags'>
    <div class="col-md-6">
      <div class="card">
        <h2>tags</h2>
        <p>If you want to add tags that don't fit into the groups above, add them here.  This group will be reviewed regularly to see if new tag groups are needed. </p>
        <paper-input id="tag-input" name="tag-input" label="Add/Edit tag" value="{{tagInput}}" on-keypress="_tagPressed"max="100" char-counter>
        </paper-input>
        <paper-button raised on-tap="addtag">Save</paper-button>
        <paper-button raised on-tap="removetag">Remove</paper-button>
      </div>
    </div>
    <div class='col-md-6'>
      <div class='card'>
        <h3>tags List</h3>

        <div class='list-group'>
          <!-- use a dom-repeat to list every element in the {{alltags}} object -->
          <template is="dom-repeat" items="{{alltags}}" as="tag">
            <button type="button" class="list-group-item" on-tap="edittag" id="li-{{index}}">[[tag]]</button>
          </template>
        </div>
    </div>
  </div>
</div>
  </template>


  <script>
//give element selector name here
    Polymer({
      is: 'ssd-admin-tags',
      properties:{
        uid:String,
        allTopics:{
          type:Object,
          observer:'dataChanged'
        },
        allrTypes:{
          type:Object,
          observer:'dataChanged'
        },
        allcollections:{
          type:Object,
          observer:'dataChanged'
        },
        allTags:{
          type:Object,
          observer:'dataChanged'
        },
        topicInput:{
          type:String,
        },
        rTypeInput:String,
        collectionInput:String,
        allTags:{
          type:Object,
          observer:'dataChanged'
        },
        persistedTopics:{
          type:Object,
          observer:'dataChanged'
        },
        persistedrTypes:{
          type:Object,
          observer:'dataChanged'
        },
        persistedTags:{
          type:Object,
          observer:'dataChanged'
        },
        persistedCollections:{
          type:Object,
          observer:'dataChanged'
        },
      },
      dataChanged:function(newData,oldData){
        //console.log(newData)
      },
      edittopic:function(e){
        if(document.querySelector(".list-group-item-info") != undefined) {
          document.querySelector(".list-group-item-info").className = ("list-group-item style-scope ssd-admin-tags");
        }

        e.srcElement.className += " editing list-group-item-info";
        this.topicId = parseInt(e.srcElement.id.split("-")[1])
        this.topicInput=this.allTopics[this.topicId]
      },
      editrType:function(e){
        if(document.querySelector(".list-group-item-info") != undefined) {
          document.querySelector(".list-group-item-info").className = ("list-group-item style-scope ssd-admin-tags");
        }
        e.srcElement.className += " editing list-group-item-info";
        this.rTypeId = parseInt(e.srcElement.id.split("-")[1]);
        this.rTypeInput=this.allrTypes[this.rTypeId];
      },
      editcollection:function(e){
        if(document.querySelector(".list-group-item-info") != undefined) {
          document.querySelector(".list-group-item-info").className = ("list-group-item style-scope ssd-admin-tags");
        }
        e.srcElement.className += " editing list-group-item-info";
        this.collectionId = parseInt(e.srcElement.id.split("-")[1]);
        this.collectionInput=this.allcollections[this.collectionId];
      },
      edittag:function(e){
        if(document.querySelector(".list-group-item-info") != undefined) {
          document.querySelector(".list-group-item-info").className = ("list-group-item style-scope ssd-admin-tags");
        }
        e.srcElement.className += " editing list-group-item-info";
        this.tagId = parseInt(e.srcElement.id.split("-")[1]);
        this.tagInput=this.alltags[this.tagId];
      },
      addtopic:function(){
        console.log(this.topicInput)
        if(this.topicInput!=null){
          if(this.allTopics.length==undefined){
            console.log('empty json');
            this.allTopics=[]
          }
          if(this.allTopics.indexOf(this.topicInput)>-1){
            console.log('duplicate topic')
          }
        else{
          if(this.topicId>-1){this.allTopics.splice(this.topicId,1)}
          var newtopics=this.allTopics
          newtopics.push(this.topicInput)
          //empty and refill to force data system to reevaluate
          this.set('allTopics',[])
          this.set('allTopics',newtopics)
        }
        this.topicId=-1
        this.topicInput=null
        }
      },
      addrType:function(){
        console.log(this.rTypeInput)
        if(this.rTypeInput!=null){
          if(this.allrTypes.length==undefined){
            console.log('empty json');
            this.allrTypes=[]
          }
          if(this.allrTypes.indexOf(this.rTypeInput)>-1){
            console.log('duplicate rType')
          }
        else{
          if(this.rTypeId>-1){this.allrTypes.splice(this.rTypeId,1)}
          var newrTypes=this.allrTypes
          newrTypes.push(this.rTypeInput)
          //empty and refill to force data system to reevaluate
          this.set('allrTypes',[])
          this.set('allrTypes',newrTypes)
        }
        this.rTypeId=-1
        this.rTypeInput=null
        }
      },
      addcollection:function(){
        console.log(this.collectionInput)
        if(this.collectionInput!=null){
          if(this.allcollections.length==undefined){
            console.log('empty json');
            this.allcollections=[]
          }
          if(this.allcollections.indexOf(this.collectionInput)>-1){
            console.log('duplicate collection')
          }
        else{
          if(this.collectionId>-1){this.allcollections.splice(this.collectionId,1)}
          var newcollections=this.allcollections
          newcollections.push(this.collectionInput)
          //empty and refill to force data system to reevaluate
          this.set('allcollections',[])
          this.set('allcollections',newcollections)
        }
        this.collectionId=-1
        this.collectionInput=null
        }
      },
      addtag:function(){
        console.log(this.tagInput)
        if(this.tagInput!=null){
          if(this.alltags.length==undefined){
            console.log('empty json');
            this.alltags=[]
          }
          if(this.alltags.indexOf(this.tagInput)>-1){
            console.log('duplicate tag')
          }
        else{
          if(this.tagId>-1){this.alltags.splice(this.tagId,1)}
          var newtags=this.alltags
          newtags.push(this.tagInput)
          //empty and refill to force data system to reevaluate
          this.set('alltags',[])
          this.set('alltags',newtags)
        }
        this.tagId=-1
        this.tagInput=null
        }
      },
      removetopic:function(){
        if(this.topicId>-1){
          var newtopics=this.allTopics;
          newtopics.splice(this.topicId,1);
          this.allTopics=[];
          this.allTopics=newtopics;
        }
        this.topicInput=null
      },
      removerType:function(){
        if(this.rTypeId>-1){
          var newrTypes=this.allrTypes;
          newrTypes.splice(this.rTypeId,1);
          this.allrTypes=[];
          this.allrTypes=newrTypes;
        }
        this.rTypeInput=null
      },
      removecollection:function(){
        if(this.collectionId>-1){
          var newcollections=this.allcollections;
          newcollections.splice(this.collectionId,1);
          this.allcollections=[];
          this.allcollections=newcollections;
        }
        this.collectionInput=null
      },
      removetag:function(){
        if(this.tagId>-1){
          var newtags=this.alltags;
          newtags.splice(this.tagId,1);
          this.alltags=[];
          this.alltags=newtags;
        }
        this.tagInput=null
      },
      _toArray: function(obj) {
            return Object.keys(obj).map(function(key) {
                return {
                    name: key,
                    value: obj[key]
                };
            });
        },

        _topicPressed: function(e) {
          console.log("yay, a keyboard press")
          console.log(e.charCode);
          if( 13 === e.charCode) {
            this.addtopic();
          }
        },
        _rTypePressed: function(e) {
          if( 13 === e.charCode) {
            this.addrType();
          }
        },
        _collectionPressed: function(e) {
          if( 13 === e.charCode) {
            this.addcollection();
          }
        },
        _tagPressed: function(e) {
          if( 13 === e.charCode) {
            this.addtag();
          }
        },
    });
  </script>
</dom-module>
