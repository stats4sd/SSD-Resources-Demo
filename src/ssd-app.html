<!-- <link rel="import" href="../bower_components/note-app-elements/na-elements.html"> -->



<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/login-fire/login-fire.html">
<link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">

<link rel="import" href="SSD Components/ssd-email-login-fire.html">
<link rel="import" href="ssd-home.html">
<link rel="import" href="ssd-resources.html">
<link rel="import" href="ssd-view404.html">
<link rel="import" href="ssd-admin-tags.html">

<link rel="import" href="my-icons.html">

<dom-module id="ssd-app">
  <template>
    <style>
       /*:host {
        --app-primary-color: var(--paper-red-700);
        --app-secondary-color: black;
        display: block;
      }

      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
        height: 96px;
      }

      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }

      .drawer-list {
        margin: 0 20px;
      }

      .user-name {
        text-align: right;
        padding-right: 16px;
        font-size: medium;
      }

      .login-details {
        color: var(--paper-red-500)
      }

      .footer {
        position: absolute;
        right: 0;
        bottom: 0;
        left: 0;
        padding: 1rem 1rem 8rem 1rem;
        text-align: center;
        /*color: var(--group-colour-900);
      }

      .enableEditing {
        background-color: var(--paper-red-900);
        color: var(--paper-red-50)
      }

      .disableEditing {
        background-color: var(--paper-blue-900);
        color: var(--paper-blue-50)
      }

      .addResource {
        background-color: var(--paper-green-900);
        color: var(--paper-green-50)
      }

      .adminButton {
        width: 100%;
        margin: 5px;
      }

      ;*/

      div.titleLogo {
        font-size: 18px;
        font-family: "Open Sans";
        font-weight: bold;
        width: 190px;
        color: white;      }
    </style>

    <!-- Setup page routing -->
    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>

    <!-- Check screen size -->
    <iron-media-query query="min-width: 500px" query-matches="{{wide}}"></iron-media-query>

    <!-- Define navigation drawer for smaller screens only -->
    <app-drawer-layout force-narrow responsiveWidth>
      <!-- Drawer content -->
      <app-drawer id="drawer">
        <!-- empty app-toolbar to match main-section top bit -->
        <app-toolbar></app-toolbar>
        <paper-menu selected="{{routeData}}" attr-for-selected="name">
          <!-- repeat through and display each (available) nav item -->
          <template is="dom-repeat" items="{{navItems}}">
            <paper-item name="{{item}}">{{item}}</paper-item>
          </template>
        </paper-menu>
      </app-drawer>


    <!-- header bar content -->
      <app-header-layout has-scrolling-region>
        <app-header condenses fixed effects="waterfall" style="background-color:#d2232a;" style="height:96px;">
          <div maintitle class='titleLogo'>Statistics for Sustainable Development</div>
          <app-toolbar sticky class="tabs-bar" style="height:64px;">
            <!-- drawer toggle button - only for narrow -->
            <paper-icon-button icon="my-icons:menu" drawer-toggle hidden$="{{wide}}"></paper-icon-button>
            <!-- Navigation for larger screens -->
            <paper-tabs selected="{{routeData}}" attr-for-selected="name" hidden$="{{!wide}}" bottom-item>
              <template is="dom-repeat" items="{{navItems}}">
                <paper-tab name="{{item}}">{{item}}</paper-tab>
              </template>
            </paper-tabs>
          </app-toolbar>


        </app-header>

        <!-- Login box (starts hidden) -->
      <paper-dialog id="login" with-backdrop center>
        <paper-dialog-scrollable>
          <!--<login-fire reverse email-password anonymous twitter github google facebook app-name="SSD-Resources"></login-fire>-->
          <ssd-email-login-fire app-name="SSD-Resources" user="{{user}}" signed-in="{{signedIn}}">
          </ssd-email-login-fire>
        </paper-dialog-scrollable>
      </paper-dialog>


  <!-- Main pages -->
      <iron-pages selected="{{routeData}}" attr-for-selected="name">
        <template is="dom-repeat" items="{{navItems}}">
          <ssd-home name="home"></ssd-home>
          <ssd-resources name="resources"></ssd-resources>
        </template>
      </iron-pages>


      </app-header-layout>




</app-drawer-layout>



  </template>

  <script>
    Polymer({
      is: 'ssd-app',
      behaviors: [Polymer.AppNetworkStatusBehavior],
      properties: {
        routeData: {
          type: String
        },
        subroute: {
          type: String
        },
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged',
        },
        user: {
          type: Object,
          observer: 'userChanged'
        },
        signedIn: {
          type: Boolean,
          observer: '_logStatus'
        },
        editingMode: {
          type: Boolean,
          value: false,
          notify: true,
        },
        wide: {
          type: Boolean,
          observer: '_wideChanged'
        },
        navItems: {
          type: Array,
          value: function() {
            return ['home','resources'];
          }
        }
      },


      _wideChanged: function(wide) {
        console.log("wide",wide);
        // if it's now wide, confirm the drawer is closed
        if(wide && this.$.drawer.opened) {
          this.$.drawer.opened = false;
        }
      },

      userChanged: function (user) { console.log('user signed in', user) },
      observers: [
        '_routePageChanged(routeData.page)',
      ],
      toggleEditing: function () {
        this.set('editingMode', !this.editingMode)
      },
      addResource: function () {
        document.querySelector('ssd-resources').addResource();
      },

      _routePageChanged: function (page) {
        this.page = page || 'home';

        if (!this.$.drawer.persistent) {
          this.$.drawer.close();
        }
      },

      _pageChanged: function (page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl('ssd-' + page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function () {
        this.page = 'view404';
      },
      _login: function () {
        login.open();
      },
      _logout: function () {
        this.$$('ssd-email-login-fire').signOut();
        console.log('logged out');
      },
      _logStatus: function () {
        if (this.signedIn) { this.$$('paper-dialog').close() }
      }
    });
  </script>
</dom-module>
