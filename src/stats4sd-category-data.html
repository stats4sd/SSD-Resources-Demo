<link rel="import" href="../bower_components/polymer/polymer-element.html">

<dom-module id="stats4sd-category-data">

  <script>
  (function() {
    let categoryList = [
          {
            "$key": "-KijSiLb_oGKl4dOKkUH",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Facademic_paper.jpg?alt=media&token=718b8dcd-ce4d-4f65-a66e-c6800f926d96",
            "label": "Academic / Research Paper",
            "modified": 1493297456599,
            "slug": "academic--research-paper",
            "type": "Resource-Type"
          }, {
            "$key": "-KijSkrdzRFfid9Z-UEU",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Faudio.jpg?alt=media&token=564cb1b0-db9a-4867-a2f3-1be7d1e47503",
            "label": "Audio File",
            "modified": 1493297466905,
            "slug": "audio-file",
            "type": "Resource-Type"
          }, {
            "$key": "-KijSmFY6UQgHvoWBTSP",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Fbook.jpg?alt=media&token=60a05982-d68d-43e7-8632-2414603254bc",
            "label": "Book",
            "modified": 1493297472596,
            "slug": "book",
            "type": "Resource-Type"
          }, {
            "$key": "-KijSqPXSYxFOraiV9k3",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Fcode.jpg?alt=media&token=c8d96cb0-5b46-4b40-83c6-fb886eccdfb9",
            "label": "Script file / Code",
            "modified": 1493297489619,
            "slug": "script-file--code",
            "type": "Resource-Type"
          }, {
            "$key": "-KijSsSpmLDdSrpuHT1L",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Fdesktop_software.jpg?alt=media&token=e08b593d-0a8a-4e16-b3c6-46c634c32663",
            "label": "Desktop Software",
            "modified": 1493297498022,
            "slug": "desktop-software",
            "type": "Resource-Type"
          }, {
            "$key": "-KijSvHsIPBrtyQxI2GI",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Finteractive_presentation.jpg?alt=media&token=6babdfcb-9ba2-4e58-b367-6952b9dbdf95",
            "label": "Interactive Presentation",
            "modified": 1493297509609,
            "slug": "interactive-presentation",
            "type": "Resource-Type"
          }, {
            "$key": "-KijSwlTh3vBWJKyu8ur",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Fmobile_app.jpg?alt=media&token=b2b55fa1-1d1e-49cc-b1da-03031158e472",
            "label": "Mobile App",
            "modified": 1493297515662,
            "slug": "mobile-app",
            "type": "Resource-Type"
          }, {
            "$key": "-KijSyXK54z5mZB3dhlS",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Fshort_text.jpg?alt=media&token=68f9304a-81ea-40ae-8916-689914086b35",
            "label": "Short Text",
            "modified": 1493297522886,
            "slug": "short-text",
            "type": "Resource-Type"
          }, {
            "$key": "-KijT-2h3LK5p1z85D1x",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Fvideo.jpg?alt=media&token=fb6598ce-125e-4714-91c9-e946c34da8a9",
            "label": "Video",
            "modified": 1493297529118,
            "slug": "video",
            "type": "Resource-Type"
          }, {
            "$key": "-KijT0fOYm_dw83rNHV1",
            "image": "https://firebasestorage.googleapis.com/v0/b/ssd-resources-demo.appspot.com/o/images%2FrTypes%2Fwebsite.jpg?alt=media&token=ec6f0f84-3c39-4201-b7e4-f2ea4e43787b",
            "label": "Website",
            "modified": 1493297535754,
            "slug": "website",
            "type": "Resource-Type"
          }, {
            "$key": "-KijedgWoC8WkOxqnwRx",
            "label": "Presentation",
            "modified": 1493300845374,
            "slug": "presentation",
            "type": "Resource-Type"
          },
        
      
      // {
      //   name: 'mens_outerwear',
      //   title: 'Men\'s Outerwear',
      //   image: 'images/mens_outerwear.jpg',
      //   placeholder: 'data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAADAA4DASIAAhEBAxEB/8QAXAABAQEAAAAAAAAAAAAAAAAAAAIEAQEAAAAAAAAAAAAAAAAAAAACEAAAAwYHAQAAAAAAAAAAAAAAERMBAhIyYhQhkaEDIwUVNREBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A3dkr5e8tfpwuneJITOzIcmQpit037Bw4mnCVNOpAAQv/2Q=='
      // },
      // {
      //   name: 'ladies_outerwear',
      //   title: 'Ladies Outerwear',
      //   image: 'images/ladies_outerwear.jpg',
      //   placeholder: 'data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAADAA4DASIAAhEBAxEB/8QAWQABAQAAAAAAAAAAAAAAAAAAAAEBAQEAAAAAAAAAAAAAAAAAAAIDEAABAwMFAQAAAAAAAAAAAAARAAEygRIDIlITMwUVEQEBAAAAAAAAAAAAAAAAAAAAQf/aAAwDAQACEQMRAD8Avqn5meQ0kwk1UyclmLtNj7L4PQoioFf/2Q=='
      // },
      // {
      //   name: 'mens_tshirts',
      //   title: 'Men\'s T-Shirts',
      //   image: 'images/mens_tshirts.jpg',
      //   placeholder: 'data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAADAA4DASIAAhEBAxEB/8QAWwABAQEAAAAAAAAAAAAAAAAAAAMEAQEAAAAAAAAAAAAAAAAAAAAAEAABAwEJAAAAAAAAAAAAAAARAAESEyFhodEygjMUBREAAwAAAAAAAAAAAAAAAAAAAEFC/9oADAMBAAIRAxEAPwDb7kupZU1MTGnvOCgxpvzEXTyRElCmf//Z'
      // },
      // {
      //   name: 'ladies_tshirts',
      //   title: 'Ladies T-Shirts',
      //   image: 'images/ladies_tshirts.jpg',
      //   placeholder: 'data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAAAeAAD/7gAOQWRvYmUAZMAAAAAB/9sAhAAQCwsLDAsQDAwQFw8NDxcbFBAQFBsfFxcXFxcfHhcaGhoaFx4eIyUnJSMeLy8zMy8vQEBAQEBAQEBAQEBAQEBAAREPDxETERUSEhUUERQRFBoUFhYUGiYaGhwaGiYwIx4eHh4jMCsuJycnLis1NTAwNTVAQD9AQEBAQEBAQEBAQED/wAARCAADAA4DASIAAhEBAxEB/8QAXwABAQEAAAAAAAAAAAAAAAAAAAMFAQEBAAAAAAAAAAAAAAAAAAABAhAAAQIDCQAAAAAAAAAAAAAAEQABITETYZECEjJCAzMVEQACAwAAAAAAAAAAAAAAAAAAATFBgf/aAAwDAQACEQMRAD8AzeADAZiFc5J7BC9Scek3VrtooilSNaf/2Q=='
      // }
    ];

    class stats4sdCategoryData extends Polymer.Element {

      static get is() { return 'stats4sd-category-data'; }

      static get properties() { return {

        categoryName: String,

        itemName: String,

        categories: {
          type: Array,
          value: categoryList,
          readOnly: true,
          notify: true
        },

        category: {
          type: Object,
          computed: '_computeCategory(categoryName)',
          notify: true
        },

        item: {
          type: Object,
          computed: '_computeItem(category.items, itemName)',
          notify: true
        },

        failure: {
          type: Boolean,
          notify: true,
          readOnly: true
        }

      }}

      _getCategoryObject(categoryName) {
        for (let i = 0, c; c = this.categories[i]; ++i) {
          // if (c.name === categoryName) {
            if (c.slug === categoryName && c.type==="Resource-Type") {
            return c;
          }
        }
      }

      _computeCategory(categoryName) {
        // Fetch the items of the category. Note that the fetch is asynchronous,
        // which means `category.items` may not be set initially (but that path
        // will be notified when the fetch completes).
        let categoryObj = this._getCategoryObject(categoryName);
        this._fetchItems(categoryObj, 1);
        return categoryObj;
      }

      _computeItem(items, itemName) {
        if (!items || !itemName) {
          return;
        }
        for (let i = 0, item; item = items[i]; ++i) {
          if (item.name === itemName) {
            return item;
          }
        }
      }

      _fetchItems(category, attempts) {
        // this._setFailure(false);
        // // Only fetch the items of a category if it has not been previously set.
        // if (!category || category.items) {
        //   return;
        // }
        // this._getResource({
        //   url: 'data/' + category.name + '.json',
        //   onLoad(e) {
        //     this.set('category.items', JSON.parse(e.target.responseText));
        //   },
        //   onError(e) {
        //     this._setFailure(true);
        //   }
        // }, attempts);
      }

      _getResource(rq, attempts) {
        // let xhr = new XMLHttpRequest();
        // xhr.addEventListener('load', rq.onLoad.bind(this));
        // xhr.addEventListener('error', (e) => {
        //   // Flaky connections might fail fetching resources
        //   if (attempts > 1) {
        //     this._getResourceDebouncer = Polymer.Debouncer.debounce(this._getResourceDebouncer,
        //       Polymer.Async.timeOut.after(200), this._getResource.bind(this, rq, attempts - 1));
        //   } else {
        //     rq.onError.call(this, e);
        //   }
        // });

        // xhr.open('GET', rq.url);
        // xhr.send();
      }

      refresh() {
        if (this.categoryName) {
          // Try at most 3 times to get the items.
          this._fetchItems(this._getCategoryObject(this.categoryName), 3);
        }
      }

    }

    customElements.define(stats4sdCategoryData.is, stats4sdCategoryData);

  })();
  </script>

</dom-module>
