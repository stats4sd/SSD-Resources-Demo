<!--Few extra imports here due to bug building https://github.com/Polymer/polymer-cli/issues/347-->
<!--web-animations script still needs to be manually added to polymer build-->
<link rel="import" href="../bower_components/platinum-sw/platinum-sw-elements.html">
<link rel="import" href="../bower_components/polymerfire/firebase-app.html">
<!--<script src="../bower_components/web-animations-js/web-animations-next.min.js"></script>-->

<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/login-fire/login-fire.html">

<link rel="import" href="../bower_components/note-app-elements/na-elements.html">
<link rel="import" href="../bower_components/app-storage/app-indexeddb-mirror/app-indexeddb-mirror.html">
<link rel="import" href="../bower_components/polymerfire/polymerfire.html">

<link rel="import" href="SSD Components/ssd-email-login-fire.html">

<link rel="import" href="my-icons.html">

<dom-module id="ssd-app">
  <template>
    <style>
      :host {
        --app-primary-color: #4285f4;
        --app-secondary-color: black;
        display: block;
      }
      
      app-header {
        color: #fff;
        background-color: var(--app-primary-color);
      }
      
      app-header paper-icon-button {
        --paper-icon-button-ink-color: white;
      }
      
      .drawer-list {
        margin: 0 20px;
      }
      
      .drawer-list a {
        display: block;
        padding: 0 16px;
        text-decoration: none;
        color: var(--app-secondary-color);
        line-height: 40px;
      }
      
      .drawer-list a.iron-selected {
        color: black;
        font-weight: bold;
      }
      .user-name{
        text-align: right;
        padding-right:16px;
      }
      .admin-pages{
        color:white!important;
        background-color: #DD3333!important;
        padding:4px 0 4px 0;
        font-weight: 200;
        padding-left:16px;
      }
    </style>
    <style include="note-app-shared-styles"></style>

    <app-location route="{{route}}"></app-location>
    <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>


    <app-drawer-layout fullbleed>
      <!-- Drawer content -->
      <app-drawer id="drawer">
        <app-toolbar>Menu</app-toolbar>
        <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation">
          <a name="resources" href="/resources">All Resources</a>
          <div hidden$="{{!signedIn}}">
            <div class="admin-pages">Admin Pages</div>
            <a name="add-resource" href="/add-resource">Add Resource</a>
            <a name="admin-tags" href="/admin-tags">Tags</a>
          </div>

        </iron-selector>
      </app-drawer>

      <!-- Main content -->
      <app-header-layout has-scrolling-region>
        <app-header condenses reveals effects="waterfall">
          <app-toolbar>
            <paper-icon-button icon="my-icons:menu" drawer-toggle></paper-icon-button>
            <div main-title>SSD Resources Demo</div>
            <iron-icon icon="cloud" hidden$="[[!online]]"></iron-icon>
            <iron-icon icon="cloud-off" hidden$="[[online]]"></iron-icon>
            <paper-icon-button icon="lock-outline" title="Login" on-tap="_login" hidden$="[[signedIn]]"></paper-icon-button>
            <paper-icon-button icon="lock-open" title="Logout" on-tap="_logout" hidden$="[[!signedIn]]"></paper-icon-button>
          </app-toolbar>
          <template is="dom-if" if="[[signedIn]]">
            <div class="user-name">signed in as [[user.displayName]]</div>
          </template>
        </app-header>
        <!--after main header pages get loaded-->
        <iron-pages selected="[[page]]" attr-for-selected="name" fallback-selection="view404" role="main">
          <ssd-resources name="resources"></ssd-resources>
          <ssd-view404 name="view404"></ssd-view404>
        </iron-pages>
        <!--pages to only show when signed in-->
        <iron-pages hidden$="{{!signedIn}}" selected="[[page]]" attr-for-selected="name" fallback-selection="view404" role="main">
          <ssd-add-resource name="add-resource"></ssd-add-resource>
          <ssd-admin-tags name="admin-tags"></ssd-admin-tags>
        </iron-pages>
      </app-header-layout>
    </app-drawer-layout>

    <paper-dialog id="login" with-backdrop center>
      <paper-dialog-scrollable>
        <!--<login-fire reverse email-password anonymous twitter github google facebook app-name="SSD-Resources"></login-fire>-->
        <ssd-email-login-fire app-name="SSD-Resources" user="{{user}}" signed-in="{{signedIn}}">
          </ssd-email-login-fire>
      </paper-dialog-scrollable>
    </paper-dialog>


  </template>

  <script>
    Polymer({
      is: 'ssd-app',
      behaviors: [Polymer.AppNetworkStatusBehavior],
      properties: {
        page: {
          type: String,
          reflectToAttribute: true,
          observer: '_pageChanged',
        },
        user:{
          type:Object,
          observer:'userChanged'
        },
        signedIn:{
          type:Boolean,
          observer:'_logStatus'
        }
      },
      userChanged:function(user){console.log(user)},

      observers: [
        '_routePageChanged(routeData.page)',
      ],

      _routePageChanged: function(page) {
        this.page = page || 'resources';

        if (!this.$.drawer.persistent) {
          this.$.drawer.close();
        }
      },

      _pageChanged: function(page) {
        // Load page import on demand. Show 404 page if fails
        var resolvedPageUrl = this.resolveUrl('ssd-' + page + '.html');
        this.importHref(resolvedPageUrl, null, this._showPage404, true);
      },

      _showPage404: function() {
        this.page = 'view404';
      },
      _login:function(){
        login.open();
      },
      _logout:function(){
        this.$$('ssd-email-login-fire').signOut();
        console.log('logged out');
      },
      _logStatus:function(){
        if(this.signedIn){this.$$('paper-dialog').close()}
      }
    });
  </script>
</dom-module>