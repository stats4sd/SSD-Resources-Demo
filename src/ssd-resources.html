<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/paper-elements/paper-elements.html">
<link rel="import" href="../bower_components/iron-elements/iron-elements.html">

<!-- <test-element obj='{"testOne":{"name":"HI","description":"Hi in detail"},"testTwo":{"name":"Hi2","description":"Hi for the 2nd time"}}'></test-element> -->

<dom-module id="ssd-resources">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      .login-details{color:var(--paper-red-500)};
    </style>

    <div class="card">
      <h1>Resources</h1>
      <p>Welcome to the SSD Resources demo.</p>
      <p>Resources should be displayed below with some info.  Click one to learn more.</p>
      <p>To access the admin pages, please login using the padlock in the top-right of the page.</p>
      <p class="login-details">username: <strong>admin@test.com</strong><br>password: <strong>test123</strong></p>
    </div>

    <!--  SETTING UP RESOURCES -->

    <div class='row'>
      <div class='col-sm-4'>
        <div class='card'>
          <paper-button toggles active="{{topicActive}}" raised>Filter by Topic</paper-button>
          <iron-collapse id="topicCollapse" opened="{{topicActive}}">
            <!-- <paper-radio-group> -->
              <template is="dom-repeat" items="{{topics}}">
                <paper-checkbox name="{{item}}" on-change='topicTapped'>{{item}}</paper-radio-button>
              </template>
            <!-- </paper-radio-group> -->
          </iron-collapse>
        </div>
      </div>



      <div class='col-sm-8'>
        <h1>Resource List</h1>
        <template id="resourceList" is="dom-repeat" items="{{_toArray(resources)}}" as="resource" filter="_filter" observe="topicFilter resource.value.topics">
          <div class="card">
            <h3>{{resource.value.name}}</h3>
            <p><span class='bold'>Description: </span>{{resource.value.description}}</p>
            <ul>
              <li>
                <span class='bold'>Topics: </span>
                <template is="dom-repeat" items="{{resource.value.topics}}" as="topic">
                  <span>{{topic}}; </span>
                </template>
              </li>
            </ul>
          </div>
        </template>

        <template id="selectedTopics" is="dom-repeat" items={{topicFilter}}>
          <h4>{{item}}</h4>
        </template>

      </div>

      <!-- FIREBASE DOCUMENTS TO PULL IN STUFF FROM DB  -->
      <firebase-document app="SSD-Resources" app-name="SSD-Resources" path="/resources" data="{{resources}}" log=true>
      </firebase-document>
      <firebase-document app="SSD-Resources" app-name="SSD-Resources" path="/topics" data="{{topics}}" log=true>
      </firebase-document>

      <!-- ARRAY SELECTOR(S)  -->
      <array-selector id='testSelector' items="{{topics}}" selected="{{topicFilter}}" multi toggle></array-selector>


  </template>

  <script>
    Polymer({
      is: 'ssd-resources',

      properties: {
        resources: Object,
        obj: Object,
        topics: Object,
        topicFilter: Array,
        topicActive: {
          type: Boolean,
          value: false
        }
      },

      // topicChanged: function() {
      //   console.log(this.topicFilter);
      // },

      // toggle: function(e){
      //   var name = e.srcElement.name;
      //   console.log(e.srcElement);
      //   console.log(name);
      //   this.$[name].toggle();
      // },

      _toArray: function(obj) {
            return Object.keys(obj).map(function(key) {
                return {
                    name: key,
                    value: obj[key]
                };
            });
        },

        _console: function(topic) {
          console.log(this.$.test_1)
        },

        _filter: function(item) {
          console.log(this.topicFilter);
          var filter = true;
          console.log(filter)
          if(!this.topicFilter == []) {
            for(i=0; i<this.topicFilter.length; i++) {
              if(item.value.topics.indexOf(this.topicFilter[i])== -1) {
                filter = false;
              }
            }
          }
          console.log(filter)
          return filter;
        },

        topicTapped: function(event) {


          var res = event.target.innerText || event.target.textContent;
          this.$.testSelector.select(res);
          console.log(this.topicFilter);
          this.$.resourceList.render();

          //
          // if(this.topicFilter.res) {
          //   this.topicFilter.res = true
          // }
          //
          //  console.log(this.topicFilter)
        }

    }


  );
  </script>
</dom-module>
